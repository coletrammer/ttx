<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.13.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ttx: Capture</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
 <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
 <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
    <!-- ... other metadata & script includes ... -->
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeFragmentCopyButton.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeParagraphLink.init();
    </script>
  </head>
  <body>
      <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0">
            <tbody>
              <tr id="projectrow">
                <td id="projectalign">
                  <div id="projectname">
                    ttx<span id="projectnumber">&#160;0.1.0</span
                    >
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_docs_2pages_2capture.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Capture</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md22"></a></p>
<p>To facilitate testing and debugging issues, it is very useful to capture the escape sequences being sent to the terminal, and be able to replay them.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
Saving Escape Sequences</h1>
<p>Saving escape sequences is as easy as writing the raw incoming bytes to a file. Replaying these bytes is also simple, and can be done via the <code>cat</code> command. However, in order for the terminal to behave the same way as when the sequences was initially ran, the terminal must start in the same state.</p>
<p>For now, this means these captures must always start from the beginning of the terminal session. In the future, once full persistence is implemented, the terminal can write out its state the moment the capture begins.</p>
<p>This leaves the only relevant configuration being the terminal's size. To keep everything self-contained, we will inject <code>CSI 8; height; width t</code> every time the terminal size changes (and once at the beginning). This escape sequence (XTWINOPS) allows the application to set the terminal width and height in cells. Since this is standard, our captures will be replayable in other terminal emulators. For good measure, we can also begin captures with an escape sequence to fully reset the terminal state.</p>
<h1><a class="anchor" id="autotoc_md24"></a>
Basic UI</h1>
<p>Currently, the only application using the <code>libttx</code> terminal emulator is <code>ttx</code>, which also contains functionality for having multiples panes and a status bar. For working with the captured escape sequences, we really want a variant which just runs the terminal emulator as a single pane. This super lightweight client could eventually be used with the same daemon <code>ttx</code>, to implement something like <code>shpool</code>. But initially we just want to have a completely isolated <code>libttx</code> terminal.</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Validating Output</h1>
<p>To validate that the terminal emulator is functioning correctly, we need to write out the terminal state to disk. When developing a test, you would manually view the terminal output to make sure it is correct, and then check in the expected output to prevent future regressions. The captured content can also be replayed on other terminals to verify correctness. This nice thing about this method of testing is that it is fully independent of the actual terminal implementation. (Which we want, because the terminal implementation is going to go through lots of changes).</p>
<p>Because <code>ttx</code> will need to support disk persistence, the validation output ought to be the same format. Also doing so naturally lets us test backwards compatibility with old versions of the disk format if we need to change it. For now, it seems like the best format for writing out the terminal state is a restricted subset of escape sequences. This makes it possible to validate the terminal state using other terminal emulators, and additionally will be completely future compatible with any refactoring on terminal state internals.</p>
<p>We will additionally need a full headless mode for the basic UI which just outputs the result of running the program to disk. This will be used by an automated test suite.</p>
<h1><a class="anchor" id="autotoc_md26"></a>
UI Tests</h1>
<p>We can actually build upon this mechanism by running <code>ttx</code> inside itself to do UI level testing of <code>ttx</code>. We would have an outer headless terminal which <code>ttx</code> runs inside and renders to. We could instrument this outer terminal to send key events and window resizes as needed, and validate <code>ttx</code> responds correctly. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="md_docs_2pages_2architecture__docs.html">Architecture Docs</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
